<script>
    window.addEventListener('load', function(event) {
        let jquery_load_check_interval = setInterval(function() {
            if (window.jQuery) {
                console.log('jQuery in Moodle: jQuery v.' + $.fn.jquery + ' loaded');
                prepareTable();
                clearInterval(jquery_load_check_interval);
            } else {
                console.log('jQuery in Moodle: new try to load jquery...');
            }
        }, 150);

        function prepareTable() {
            sessions = $('.category[data-categoryid="4"]');
            $('#sessions').prepend(sessions);
            $('#sessions h3').css('display', 'none');
            for (let block = 1; block <= 4; block++) {
                let selector = "#sessions .category .category:nth-of-type(" + block + ") .coursebox";
                prepareCourses(selector);
            }
        }

        function prepareCourses(selector) {
            let check = $(selector);
            for (let i = 0; i < check.length; i++) {
                let room;
                switch (i) {
                    case 0:
                        room = "B030"; break;
                    case 1: 
                        room = "B032"; break;
                    case 2:
                        room = "B129"; break;
                    case 3: 
                        room = "B338"; break;
                    case 4:
                        room = "B341"; break;
                    case 5: 
                        room = "B346"; break;
                    case 6:
                        room = "B437"; break;
                    case 7: 
                        room = "B439"; break;   
                    case 8: 
                        room = "B449"; break;                        
                }
                if (check[i].textContent.includes('FREI')) {
                    //let room = check[i].children[0].children[0].children[0].text.split('-')[1];
                    check[i].children[0].children[1].style.display = 'none';
                    check[i].children[0].children[0].children[0].text = 'Raum ' + room + ' buchen';
                    check[i].children[0].children[0].children[0].classList.add('btn', 'btn-secondary','btn-sm');
                } else {
                    //let roomcontainer = '<span class="room">' + room + '</span>';
                    //check[i].children[0].children[0].children[0].append(roomcontainer);
                    roomcontainer = document.createElement("span")
                    roomcontainer.classList.add("room");
                    roomcontainer.textContent = room;
                    check[i].children[0].children[0].children[0].append(roomcontainer);
                }
            }
        }

    }, false);

    let checkDisplay = function() {
        let sessiondisplay = $('#sessions').css('display');
        switch (sessiondisplay) {
            case 'flex':
                $('#sessions').css('display', 'none');
                break;
            case 'none':
                $('#sessions').css('display', 'flex');
                break;
            }
    };
</script>
